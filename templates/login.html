<!DOCTYPE html>
<html>
<head>
    <title>Login - Voice</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h2>Login</h2>
    
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flashes" id="flash-messages">
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    
    <form method="POST" enctype="multipart/form-data" id="login-form">
        <label for="username">Username:</label>
        <input type="text" name="username" required><br><br>
        
        <p>Speak your saved passphrase now:</p>
        
        <button type="button" class="record-btn" data-form="login-form" disabled>Start Recording</button>
        
        <div class="status-message">Click Start Recording to begin verification.</div>
        <audio class="audio-playback" controls style="display:block; margin-top: 10px;"></audio>
        <br>
        
        <input type="submit" value="Login">
    </form>
    <a href="{{ url_for('index') }}">Home</a>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    
    <script>
        if ('speechSynthesis' in window) {
            const flashMessages = document.getElementById('flash-messages');
            if (flashMessages && flashMessages.children.length > 0) {
                const messageText = flashMessages.children[0].textContent.trim();
                
                // Only speak if it's likely a failure message (and not a "Signup successful" message)
                if (messageText.includes("Hmm...") || messageText.includes("Not quite") || messageText.includes("failed")) {
                    const msg = new SpeechSynthesisUtterance(messageText);
                    window.speechSynthesis.speak(msg);
                }
            }
        }
    </script>
</body>
</html>
